<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Config State | Configuration</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.2fe2820e.js" as="script"><link rel="preload" href="/assets/js/2.7a33be8c.js" as="script"><link rel="preload" href="/assets/js/8.8810ae2b.js" as="script"><link rel="prefetch" href="/assets/js/3.ea20158e.js"><link rel="prefetch" href="/assets/js/4.b4c91b0e.js"><link rel="prefetch" href="/assets/js/5.0969e098.js"><link rel="prefetch" href="/assets/js/6.e4c8cbb1.js"><link rel="prefetch" href="/assets/js/7.e5302579.js"><link rel="prefetch" href="/assets/js/9.ef748947.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Configuration</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Configuration - a different approach</a></li><li><a href="/guide/GettingStarted.html" class="sidebar-link">Getting started</a></li><li><a href="/guide/ConfigState.html" aria-current="page" class="active sidebar-link">Config State</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/ConfigState.html#general-api" class="sidebar-link">General API</a></li><li class="sidebar-sub-header"><a href="/guide/ConfigState.html#path-access" class="sidebar-link">Path Access</a></li><li class="sidebar-sub-header"><a href="/guide/ConfigState.html#namespacing" class="sidebar-link">Namespacing</a></li><li class="sidebar-sub-header"><a href="/guide/ConfigState.html#watchers" class="sidebar-link">Watchers</a></li><li class="sidebar-sub-header"><a href="/guide/ConfigState.html#object-property-syncing" class="sidebar-link">Object property syncing</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="config-state"><a href="#config-state" class="header-anchor">#</a> Config State</h1> <p>The config state is the result of the configuration loader.
It holds (in general) all collected information provided by the config classes.
It provides a simple interface to retrieve and even update its contents at runtime.</p> <h2 id="general-api"><a href="#general-api" class="header-anchor">#</a> General API</h2> <h3 id="has"><a href="#has" class="header-anchor">#</a> has()</h3> <p>Returns true if a given key exists, false if not.
Note: The method is namespace sensitive!</p> <details class="custom-block details"><summary>Arguments</summary> <ul><li>$key  A key or path to get the value for</li></ul></details> <h3 id="get"><a href="#get" class="header-anchor">#</a> get()</h3> <p>Returns the stored value for a given key, or returns the $fallback
if the key was not found. Note: The method is namespace sensitive!</p> <details class="custom-block details"><summary>Arguments</summary> <ul><li>$key       Either a simple key or a colon separated path to find the value at</li> <li>$fallback  Returned if the $key was not found in the state</li></ul></details> <h3 id="getall"><a href="#getall" class="header-anchor">#</a> getAll()</h3> <p>Returns the whole state content as an array</p> <h3 id="set"><a href="#set" class="header-anchor">#</a> set()</h3> <p>Sets a value in the config state
Note: The method is namespace sensitive!</p> <details class="custom-block details"><summary>Arguments</summary> <ul><li>$key    Either a simple key or a colon separated path to set the value at</li> <li>$value  The value to set for the given key.
NOTE: When the state is cached all values MUST be JSON serializable!</li></ul></details> <h2 id="path-access"><a href="#path-access" class="header-anchor">#</a> Path Access</h2> <p>All actions performed on the collected state are executed using the <a href="https://github.com/Neunerlei/arrays" target="_blank" rel="noopener noreferrer">Neunerlei/Arrays<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> package.
This means all $keys can also be colon separated paths (<a href="https://arrays.neunerlei.eu/guide/PathAccess.html#path-definition" target="_blank" rel="noopener noreferrer">see the definition<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) for deep lookups.</p> <h2 id="namespacing"><a href="#namespacing" class="header-anchor">#</a> Namespacing</h2> <p>If you perform multiple actions in the same sub path it may come in handy to define a certain namespace.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">use</span> <span class="token package">Neunerlei<span class="token punctuation">\</span>Configuration<span class="token punctuation">\</span>State<span class="token punctuation">\</span>ConfigState</span><span class="token punctuation">;</span>
<span class="token variable">$state</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConfigState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Instead of this</span>
<span class="token variable">$state</span><span class="token operator">-&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo.bar.baz'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$state</span><span class="token operator">-&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo.bar.bar'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$state</span><span class="token operator">-&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo.bar.roo'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// You can do this, which will lead to the same result</span>
<span class="token variable">$state</span><span class="token operator">-&gt;</span><span class="token function">useNamespace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo.bar'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$state</span><span class="token operator">-&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'baz'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$state</span><span class="token operator">-&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bar'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$state</span><span class="token operator">-&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'roo'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// You can even nest this method like so</span>
<span class="token variable">$state</span><span class="token operator">-&gt;</span><span class="token function">useNamespace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo.bar'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$state</span><span class="token operator">-&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'baz'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// &quot;bar&quot; will be added on the root level, because the namespace is set to NULL</span>
    <span class="token variable">$state</span><span class="token operator">-&gt;</span><span class="token function">useNamespace</span><span class="token punctuation">(</span><span class="token constant">null</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$state</span><span class="token operator">-&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bar'</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Note, that namespaces do not stack. So this leads to &quot;bar.baz.foo&quot; and not to &quot;foo.bar.bar.baz.foo&quot;</span>
    <span class="token variable">$state</span><span class="token operator">-&gt;</span><span class="token function">useNamespace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bar.baz'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$state</span><span class="token operator">-&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// This will now be back to &quot;foo.bar.foo&quot;</span>
    <span class="token variable">$state</span><span class="token operator">-&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><h2 id="watchers"><a href="#watchers" class="header-anchor">#</a> Watchers</h2> <p>The config sate object is watchable by your code. This means if a config property is changed on runtime
you can register a callback to do something with the changed value.</p> <p>Adds a new watcher for a storage key. Watchers will be executed every time
their respective key or one of their children gets updated using the set() methods.</p> <p>This means you can get notified if a configuration state changes.</p> <div class="custom-block tip"><p class="custom-block-title">Example</p> <p>If you register a watcher on the key: &quot;foo.bar&quot;
and set a value to $state-&gt;set('foo', ['test' =&gt; 123]);
your watcher will NOT be triggered, because &quot;foo.test&quot; is not being watched.</p> <p>However, if you set another value to $state-&gt;set('foo', ['bar' =&gt; 123]);
your watcher will be triggered, because &quot;foo.bar&quot; got updated.</p> <p>It will also work if you set $state-&gt;set('foo.bar', 123) directly.</p> <p>The watcher will also get notified if you set one of its children.
This means if you set something like $state-&gt;set('foo.bar.baz', 123), the watcher will trigger,
because it listens to deep changes.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Only simple paths are supported as watcher keys, meaning stuff like &quot;foo.bar[foo,bar]&quot; or &quot;foo.*.bar&quot; will NOT work!</p></div> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">use</span> <span class="token package">Neunerlei<span class="token punctuation">\</span>Configuration<span class="token punctuation">\</span>State<span class="token punctuation">\</span>ConfigState</span><span class="token punctuation">;</span>

<span class="token variable">$state</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConfigState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$state</span><span class="token operator">-&gt;</span><span class="token function">addWatcher</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// $v will be 'asdf'</span>
    <span class="token keyword">echo</span> <span class="token variable">$v</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$state</span><span class="token operator">-&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asdf'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><h2 id="object-property-syncing"><a href="#object-property-syncing" class="header-anchor">#</a> Object property syncing</h2> <p>In some cases you have to access specific config properties hundreds or thousands of times while the script is executed.
(Think of options that may affect how translation labels are handled or repetitive tasks like table rendering.)
This may lead to a lot of overhead if you always use $configState-&gt;get('your.key').</p> <p>You can of course store the config property before you start the repetitive task, but that means if the configuration
was changed during runtime you might not get the latest state, leading to a de-sync between configuration
and your implementation.</p> <p>To prevent this you can use the &quot;LocallyCachedStatePropertyTrait&quot; that allows you to keep a local property in sync
with a specific configuration state.</p> <p>As an example: We have our translator that gets the language from the config state</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">use</span> <span class="token package">Neunerlei<span class="token punctuation">\</span>Configuration<span class="token punctuation">\</span>State<span class="token punctuation">\</span>ConfigState</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Neunerlei<span class="token punctuation">\</span>Configuration<span class="token punctuation">\</span>State<span class="token punctuation">\</span>LocallyCachedStatePropertyTrait</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Translator</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">LocallyCachedStatePropertyTrait</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * The two char language code to translate
     * @var string
     */</span>
    <span class="token keyword">protected</span> <span class="token variable">$languageKey</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * The list of translations
     * @var array
     */</span>
    <span class="token keyword">protected</span> <span class="token variable">$translations</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'en'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'...'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'de'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'...'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ConfigState</span> <span class="token variable">$state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// This will now keep the $this-&gt;languageKey property in sync with translation.languageKey</span>
        <span class="token comment">// In your config state object. So even if &quot;translation.languageKey&quot; was changed your translator</span>
        <span class="token comment">// will use the the correct language key, without the overhead of firing a query every time</span>
        <span class="token comment">// a label gets translated</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">registerCachedProperty</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'languageKey'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'translation.languageKey'</span><span class="token punctuation">,</span> <span class="token variable">$state</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">translate</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$label</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">translations</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">languageKey</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$label</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guide/GettingStarted.html" class="prev">
        Getting started
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2fe2820e.js" defer></script><script src="/assets/js/2.7a33be8c.js" defer></script><script src="/assets/js/8.8810ae2b.js" defer></script>
  </body>
</html>
